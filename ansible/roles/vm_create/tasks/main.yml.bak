---

- hosts: all
  become: true
  #vars_files:
  #  - vars/default.yml
  tasks:
    - name: create volumes
      command: >
              virsh vol-create-as uvtool {{ item.key }}.{{ item.value.file_type }} 10M
      with_dict: "{{ guests }}"
    - name: create vm
      command: >
              virt-install --name={{ item.key }} --ram={{ item.value.mem }} --vcpus={{ item.value.cpus }} --mac={{ item.value.mac }} \
              --disk path=/var/lib/uvtool/libvirt/images/{{ item.key }}.{{ item.value.file_type }},bus=virtio \
              --pxe --noautoconsole --graphics=vnc --hvm \
              --network network=ocp,model=virtio --boot hd,network
      with_dict: "{{ guests }}"

vm_location: "/data/VMs"
guests:
  bootstrap:
    mem: 512
    cpus: 1
    mac: 52:54:00:02:85:01
    file_type: qcow2
  master1:
    mem: 512
    cpus: 1
    mac: 52:54:00:02:86:01
    file_type: qcow2
  worker1:
    mem: 512
    cpus: 1
    mac: 52:54:00:02:87:01
    file_type: qcow2
  worker2:
    mem: 512
    cpus: 1
    mac: 52:54:00:02:87:02
    file_type: qcow2
  worker3:
    mem: 512
    cpus: 1
    mac: 52:54:00:02:87:03
    file_type: qcow2


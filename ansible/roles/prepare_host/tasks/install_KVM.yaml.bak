- name: Display if Virtualization is installed
  shell: kvm-ok | grep 'KVM acceleration can be used'

- name: Install a list of packages
  apt:
   name: "{{ item }}"
   update_cache: yes
   state: present
  with_items:
    - 'qemu'
    - 'qemu-kvm'
    - 'libvirt-bin'
    - 'bridge-utils'
    - 'virt-manager'
    - 'uvtool'

- name: Make sure libvirtd service is running
  systemd:
    state: started
    enabled: yes
    name: libvirtd

- name: Install the basic ubuntu image (Bionic Beaver) for uvtool to create the load balancer and nfs server from
  shell: uvt-simplestreams-libvirt --verbose sync release=bionic arch=amd64

- name: Create the key for the metal root user to use to access the VMs on the host machine command line
  shell: ssh-keygen -b 4096 -t rsa -f ~/.ssh/id_rsa -N ""

